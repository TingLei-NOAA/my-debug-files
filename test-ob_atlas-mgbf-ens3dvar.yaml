cost function:
  cost type: 3D-Var
  time window:
      begin: 2024-05-26T22:00:00Z
      length: PT6H
  analysis variables: &3dvars [eastward_wind,northward_wind,air_temperature,air_pressure_thickness,water_vapor_mixing_ratio_wrt_moist_air,cloud_liquid_ice,cloud_liquid_water,ozone_mass_mixing_ratio]

  geometry:
    fms initialization:
      namelist filename: DataFix/fmsmpp.nml
      field table filename: DataFix/field_table
    namelist filename: DataFix/input_lam_C775_NP22X22.nml
    akbk: DataFix/fix/akbk66.nc
    # input.nml
    npz: 65
    layout: [22,22]
    io_layout: [1,1]
    ntiles: 1


  background:
    datetime: &analysisDate 2024-05-27T01:00:00Z
    filetype: fms restart
    datapath: data/bkg
    filename_core: 20240527.010000.fv_core.res.tile1.nc
    filename_trcr: 20240527.010000.fv_tracer.res.tile1.nc
    filename_sfcd: 20240527.010000.sfc_data.nc
    filename_sfcw: 20240527.010000.fv_srf_wnd.res.tile1.nc
    filename_cplr: 20240527.010000.coupler.res
    state variables:
      - eastward_wind
      - northward_wind
      - air_temperature
      - air_pressure_thickness
      - water_vapor_mixing_ratio_wrt_moist_air
      - cloud_liquid_ice
      - cloud_liquid_water
      - ozone_mass_mixing_ratio
      - geopotential_height_times_gravity_at_surface
      - f10m
      - slmsk
      - sheleg
      - skin_temperature_at_surface
      - vtype
      - stype
      - vfrac
      - soilt
      - soilm
      - eastward_wind_at_surface
      - northward_wind_at_surface
    field io names: &io_names
      eastward_wind: ua
      northward_wind: va
      air_temperature: T
      air_pressure_thickness: delp 
      water_vapor_mixing_ratio_wrt_moist_air: sphum
      cloud_liquid_ice: ice_wat
      cloud_liquid_water: liq_wat
      ozone_mass_mixing_ratio: o3mr
      geopotential_height_times_gravity_at_surface: phis
      skin_temperature_at_surface: tsfc
      soilt: tslb
      soilm: smois
      eastward_wind_at_surface: u_srf
      northward_wind_at_surface: v_srf
  background error:
    covariance model: ensemble
    members from template:
      template:
        datetime: 2024-05-27T01:00:00Z
        filetype: fms restart
        state variables: *3dvars
        field io names: *io_names
        datapath: data/inputs/mem%mem%/
        filename_core: 20240527.010000.fv_core.res.tile1.nc
        filename_trcr: 20240527.010000.fv_tracer.res.tile1.nc
        filename_sfcd: 20240527.010000.sfc_data.nc
        filename_sfcw: 20240527.010000.fv_srf_wnd.res.tile1.nc
        filename_cplr: 20240527.010000.coupler.res
      pattern: "%mem%"
      nmembers: 2 
      zero padding: 3
    localization:
      localization method: SABER
      saber central block:
        saber block name: MGBF_covariance
        mgbf namelist file: dr-mgbf-fix/test-mgbf.nml
      saber outer blocks:
      -  saber block name: interpolation
         inner geometry:
           function space: StructuredColumns
           grid:
             type: structured
             xspace:
               type: linear
               N: 308
               start: -60.0310278618037
               end:   60.0310278618037
               endpoint: true
             yspace:
               type: linear
               N: 308
               start: -36.6574659140194
               end:   36.6574659140194
               endpoint: true
             projection:
               type: rotated_lonlat
               north_pole: [67.4999923706, 34.9999966097]
             y_numbering: 1

           halo: 1
           partitioner: checkerboard

         forward interpolator:
             local interpolator type: oops unstructured grid interpolator
         inverse interpolator:
             local nterpolator type: oops unstructured grid interpolator
  observations:
    observers:
    - obs space:
        name: aircar_airTemperature_133
        distribution: &id004
          name: Atlas
          grid:
            type: regular_lonlat
            nx: 300
            ny: 300
            halo: 1
            global: false
            include_pole: false
            xmin: 0.00024150533135980368
            xmax: 359.99810791015625
            ymin: 3.74735164642334
            ymax: 89.98715209960938
            partitioner: equal_regions 
        obsdatain:
          engine:
            type: H5File
            obsfile: data/obs/ioda_aircar.nc
            missing file action: warn
          obsgrouping:
            group variables:
            - stationIdentification
            sort variable: pressure
            sort order: descending
        obsdataout:
          empty obs space action: create output
          engine:
            type: H5File
            obsfile: jdiag_aircar_airTemperature_133.nc
            allow overwrite: true
          write multiple files: true
        io pool:
          max pool size: 40
        observed variables:
        - airTemperature
        simulated variables:
        - airTemperature
      obs operator:
        name: VertInterp
        vertical coordinate: air_pressure
        observation vertical coordinate: pressure
        observation vertical coordinate group: MetaData
        interpolation method: log-linear
        variables:
        - name: airTemperature
      linear obs operator:
        name: VertInterp
      obs error:
        covariance model: diagonal
      obs localizations:
      - localization method: Horizontal Gaspari-Cohn
        lengthscale: 200e3
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: 133
        action:
          name: accept
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_not_in: 133
        action:
          name: reduce obs space
      - filter: RejectList
        filter variables:
        - name: airTemperature
        where:
        - variable: QualityMarker/airTemperature
          is_in: 4-15
          value: is_not_valid
        where operator: or
        action:
          name: reduce obs space
      - filter: Domain Check
        where:
        - variable:
            name: MetaData/timeOffset
          minvalue: -5400
          maxvalue: 5400
        action:
          name: reduce obs space
      - filter: Bounds Check
        filter variables:
        - name: airTemperature
        test variables:
        - name: GeoVaLs/observable_domain_mask
        minvalue: 0.0
        maxvalue: 0.5
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: 133
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals:
              - 110000
              - 105000
              - 100000
              - 95000
              - 90000
              - 85000
              - 80000
              - 75000
              - 70000
              - 65000
              - 60000
              - 55000
              - 50000
              - 45000
              - 40000
              - 35000
              - 30000
              - 25000
              - 20000
              - 15000
              - 10000
              - 7500
              - 5000
              - 4000
              - 3000
              - 2000
              - 1000
              - 500
              - 400
              - 300
              - 200
              - 100
              - 0
              errors:
              - 1.4088
              - 1.3361
              - 1.2395
              - 1.1379
              - 1.0505
              - 0.98154
              - 0.92451
              - 0.87349
              - 0.82829
              - 0.79582
              - 0.77562
              - 0.75911
              - 0.7408
              - 0.72571
              - 0.72719
              - 0.75204
              - 0.80129
              - 0.8696
              - 0.93292
              - 0.9672
              - 0.9831
              - 0.99132
              - 0.99603
              - 0.99854
              - 0.99963
              - 0.99997
              - 1.0
              - 0.99999
              - 0.99995
              - 0.99985
              - 0.99958
              - 0.99914
              - 0.99869
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: 133
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: airTemperature
              inflation factor: 8.0
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: QualityMarker/airTemperature
          is_in: 3
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          maxvalue: 10000.0
      - filter: Bounds Check
        filter variables:
        - name: airTemperature
        test variables:
        - name: ObsErrorData/airTemperature
        minvalue: 0.0
        maxvalue: 1000
        action:
          name: reduce obs space
      - filter: Bounds Check
        filter variables:
        - name: airTemperature
        minvalue: 100
        maxvalue: 400
        action:
          name: reduce obs space
      - filter: Variable Assignment
        apply at iterations: 0,1
        assignments:
        - name: TempObsErrorData/airTemperature
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/airTemperature
        defer to post: true
      - filter: Perform Action
        apply at iterations: 0,1
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error parameter: 1.3
        where:
        - variable:
            name: ObsErrorData/airTemperature
          maxvalue: 1.3
        - variable:
            name: ObsErrorData/airTemperature
          value: is_valid
        defer to post: true
      - filter: Perform Action
        apply at iterations: 0,1
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error parameter: 5.6
        where:
        - variable:
            name: ObsErrorData/airTemperature
          minvalue: 5.6
        - variable:
            name: ObsErrorData/airTemperature
          value: is_valid
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: airTemperature
        threshold: 7.0
        action:
          name: reject
        where:
        - variable: ObsType/airTemperature
        - variable: QualityMarker/airTemperature
          is_not_in: 3
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: airTemperature
        threshold: 4.9
        action:
          name: reject
        where:
        - variable: ObsType/airTemperature
        - variable: QualityMarker/airTemperature
          is_in: 3
        defer to post: true
      - filter: Perform Action
        apply at iterations: 0,1
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error function: TempObsErrorData/airTemperature
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          value: is_valid
        defer to post: true
    - obs space:
        name: aircar_specificHumidity_133
        distribution: *id004
        obsdatain:
          engine:
            type: H5File
            obsfile: data/obs/ioda_aircar.nc
            missing file action: warn
          obsgrouping:
            group variables:
            - stationIdentification
            sort variable: pressure
            sort order: descending
        obsdataout:
          empty obs space action: create output
          engine:
            type: H5File
            obsfile: jdiag_aircar_specificHumidity_133.nc
            allow overwrite: true
          write multiple files: true
        io pool:
          max pool size: 40
        observed variables:
        - specificHumidity
        simulated variables:
        - specificHumidity
      obs operator:
        name: VertInterp
        vertical coordinate: air_pressure
        observation vertical coordinate: pressure
        observation vertical coordinate group: MetaData
        interpolation method: log-linear
        variables:
        - name: specificHumidity
      linear obs operator:
        name: VertInterp
      obs error:
        covariance model: diagonal
      obs localizations:
      - localization method: Horizontal Gaspari-Cohn
        lengthscale: 200e3
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: 133
        action:
          name: accept
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_not_in: 133
        action:
          name: reduce obs space
      - filter: RejectList
        filter variables:
        - name: specificHumidity
        where:
        - variable: QualityMarker/specificHumidity
          is_in: 4-15
          value: is_not_valid
        where operator: or
        action:
          name: reduce obs space
      - filter: Domain Check
        where:
        - variable:
            name: MetaData/timeOffset
          minvalue: -5400
          maxvalue: 5400
        action:
          name: reduce obs space
      - filter: Bounds Check
        filter variables:
        - name: specificHumidity
        test variables:
        - name: GeoVaLs/observable_domain_mask
        minvalue: 0.0
        maxvalue: 0.5
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: 133
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals:
              - 110000
              - 105000
              - 100000
              - 95000
              - 90000
              - 85000
              - 80000
              - 75000
              - 70000
              - 65000
              - 60000
              - 55000
              - 50000
              - 45000
              - 40000
              - 35000
              - 30000
              - 25000
              - 20000
              - 15000
              - 10000
              - 7500
              - 5000
              - 4000
              - 3000
              - 2000
              - 1000
              - 500
              - 400
              - 300
              - 200
              - 100
              - 0
              errors:
              - 0.19455
              - 0.19064
              - 0.18488
              - 0.17877
              - 0.17342
              - 0.16976
              - 0.16777
              - 0.16696
              - 0.16605
              - 0.16522
              - 0.16637
              - 0.17086
              - 0.17791
              - 0.18492
              - 0.18996
              - 0.19294
              - 0.19447
              - 0.19597
              - 0.19748
              - 0.19866
              - 0.19941
              - 0.19979
              - 0.19994
              - 0.19999
              - 0.2
              - 0.2
              - 0.2
              - 0.2
              - 0.2
              - 0.2
              - 0.2
              - 0.2
              - 0.2
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: 133
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: specificHumidity
              inflation factor: 8.0
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: QualityMarker/specificHumidity
          is_in: 3
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          maxvalue: 10000.0
      - filter: Bounds Check
        filter variables:
        - name: specificHumidity
        test variables:
        - name: ObsErrorData/specificHumidity
        minvalue: 0.0
        maxvalue: 1000
        action:
          name: reduce obs space
      - filter: Bounds Check
        filter variables:
        - name: specificHumidity
        minvalue: 0.0
        maxvalue: 1.0
        action:
          name: reduce obs space
      - filter: Variable Assignment
        apply at iterations: 0,1
        assignments:
        - name: TempObsErrorData/specificHumidity
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/specificHumidity
        defer to post: true
      - filter: Perform Action
        apply at iterations: 0,1
        filter variables:
        - name: specificHumidity
        action:
          name: assign error
          error parameter: 5.0
        where:
        - variable:
            name: ObsErrorData/specificHumidity
          maxvalue: 5.0
        - variable:
            name: ObsErrorData/specificHumidity
          value: is_valid
        defer to post: true
      - filter: Perform Action
        apply at iterations: 0,1
        filter variables:
        - name: specificHumidity
        action:
          name: assign error
          error parameter: 50.0
        where:
        - variable:
            name: ObsErrorData/specificHumidity
          minvalue: 50.0
        - variable:
            name: ObsErrorData/specificHumidity
          value: is_valid
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: specificHumidity
        threshold: 7.0
        action:
          name: reject
        where:
        - variable: ObsType/specificHumidity
        - variable: QualityMarker/specificHumidity
          is_not_in: 3
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: specificHumidity
        threshold: 4.9
        action:
          name: reject
        where:
        - variable: ObsType/specificHumidity
        - variable: QualityMarker/specificHumidity
          is_in: 3
        defer to post: true
      - filter: Perform Action
        apply at iterations: 0,1
        filter variables:
        - name: specificHumidity
        action:
          name: assign error
          error function: TempObsErrorData/specificHumidity
        where:
        - variable:
            name: TempObsErrorData/specificHumidity
          value: is_valid
        defer to post: true
    - obs space:
        name: aircar_winds_233
        distribution: *id004
        obsdatain:
          engine:
            type: H5File
            obsfile: data/obs/ioda_aircar.nc
            missing file action: warn
          obsgrouping:
            group variables:
            - stationIdentification
            sort variable: pressure
            sort order: descending
        obsdataout:
          empty obs space action: create output
          engine:
            type: H5File
            obsfile: jdiag_aircar_winds_233.nc
            allow overwrite: true
          write multiple files: true
        io pool:
          max pool size: 40
        observed variables:
        - windEastward
        - windNorthward
        simulated variables:
        - windEastward
        - windNorthward
      obs operator:
        name: VertInterp
        vertical coordinate: air_pressure
        observation vertical coordinate: pressure
        observation vertical coordinate group: MetaData
        interpolation method: log-linear
        variables:
        - name: windEastward
        - name: windNorthward
      linear obs operator:
        name: VertInterp
      obs error:
        covariance model: diagonal
      obs localizations:
      - localization method: Horizontal Gaspari-Cohn
        lengthscale: 200e3
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        where:
        - variable: ObsType/windEastward
          is_in: 233
        action:
          name: accept
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        where:
        - variable: ObsType/windEastward
          is_not_in: 233
        action:
          name: reduce obs space
      - filter: RejectList
        filter variables:
        - name: windEastward
        - name: windNorthward
        where:
        - variable: QualityMarker/windEastward
          is_in: 4-15
          value: is_not_valid
        where operator: or
        action:
          name: reduce obs space
      - filter: Domain Check
        where:
        - variable:
            name: MetaData/timeOffset
          minvalue: -5400
          maxvalue: 5400
        action:
          name: reduce obs space
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: GeoVaLs/observable_domain_mask
        minvalue: 0.0
        maxvalue: 0.5
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        where:
        - variable: ObsType/windEastward
          is_in: 233
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals:
              - 110000
              - 105000
              - 100000
              - 95000
              - 90000
              - 85000
              - 80000
              - 75000
              - 70000
              - 65000
              - 60000
              - 55000
              - 50000
              - 45000
              - 40000
              - 35000
              - 30000
              - 25000
              - 20000
              - 15000
              - 10000
              - 7500
              - 5000
              - 4000
              - 3000
              - 2000
              - 1000
              - 500
              - 400
              - 300
              - 200
              - 100
              - 0
              errors:
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
              - 2.3214
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: ObsType/windEastward
          is_in: 233
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windEastward
              inflation factor: 4.0
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
        - variable: ObsType/windNorthward
          is_in: 233
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windNorthward
              inflation factor: 4.0
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: QualityMarker/windEastward
          is_in: 3
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          maxvalue: 5000.0
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: ObsErrorData/windEastward
        minvalue: 0.0
        maxvalue: 1000
        action:
          name: reduce obs space
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        minvalue: -200
        maxvalue: 200
        action:
          name: reduce obs space
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: windEastward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype:
            - 233
            cgross:
            - 7.5
            error_min:
            - 1.4
            error_max:
            - 6.1
            variable: windEastward
        where:
        - variable: QualityMarker/windEastward
          is_not_in: 3
        action:
          name: reject
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: windNorthward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype:
            - 233
            cgross:
            - 7.5
            error_min:
            - 1.4
            error_max:
            - 6.1
            variable: windNorthward
        where:
        - variable: QualityMarker/windNorthward
          is_not_in: 3
        action:
          name: reject
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: windEastward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype:
            - 233
            cgross:
            - 5.25
            error_min:
            - 1.4
            error_max:
            - 6.1
            variable: windEastward
        where:
        - variable: QualityMarker/windEastward
          is_in: 3
        action:
          name: reject
        defer to post: true
      - filter: Background Check
        apply at iterations: 0,1
        filter variables:
        - name: windNorthward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype:
            - 233
            cgross:
            - 5.25
            error_min:
            - 1.4
            error_max:
            - 6.1
            variable: windNorthward
        where:
        - variable: QualityMarker/windNorthward
          is_in: 3
        action:
          name: reject
        defer to post: true




variational:
  minimizer:
    algorithm: DRPCG
  iterations:
  - ninner: 50
    gradient norm reduction: 1e-5
    geometry:
      fms initialization:
        namelist filename: DataFix/fmsmpp.nml
        field table filename: DataFix/field_table
      namelist filename: DataFix/input_lam_C775_NP22X22.nml
      akbk: DataFix/fix/akbk66.nc
      # input.nml
      npz: 65
      layout: [22,22]
      io_layout: [1,1]
      ntiles: 1
      fieldsets:
      - fieldset: DataFix/fix/dynamics_lam_cmaq.yaml
  - ninner: 50
    gradient norm reduction: 1e-5
    geometry:
      fms initialization:
        namelist filename: DataFix/fmsmpp.nml
        field table filename: DataFix/field_table
      namelist filename: DataFix/input_lam_C775_NP22X22.nml
      akbk: DataFix/fix/akbk66.nc
      # input.nml
      npz: 65
      layout: [22,22]
      io_layout: [1,1]
      ntiles: 1
      fieldsets:
      - fieldset: DataFix/fix/dynamics_lam_cmaq.yaml

  frequency: PT1H


output:
  filetype: fms restart
  datapath: ./
  prefix: ens3dvar-fv3_lam-C775-ob_atlas #Ens3dvar-fv3_lam-C775
  frequency: PT1H
